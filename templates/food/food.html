{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>food</title>
    <link rel="stylesheet" href="{% static 'css/food.css' %}">
    <link rel="stylesheet" href="{% static 'css/fontawesome.min.css' %}">


</head>

<body>
    <header>
        <nav class="link1">
            <div class="logo">
                <div>
                    <img src="{% static 'image/logo.jpg' %}">
                </div>
                <p>Mango Food</p>
            </div>

             <ul>
                <li><a href="{% url 'userdashboard' %}"><i class="fas fa-user"></i> Dashboard</a></li>
            </ul> 

            <ul>
                <li>
                    <form method="POST" action="logout">
                        {% csrf_token %}
                        <button type="submit">Logout</button>
                    </form>
                </li>
            </ul>
            

            <ul>
                <li><a href="{% url 'chat' %}">Help</a></li>
            </ul>
            

            <div>
                <button id="cart">My Cart
                    <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"viewBox="0 0 243.5 243.5" style="enable-background:new 0 0 243.5 243.5;" xml:space="preserve">
                        <g>
                            <path d="M113.403,157.775c0.399,3.858,3.655,6.729,7.451,6.729c0.258,0,0.518-0.013,0.78-0.04c4.12-0.426,7.115-4.111,6.689-8.232
                                l-3.458-33.468c-0.426-4.121-4.11-7.112-8.231-6.689c-4.12,0.426-7.115,4.111-6.69,8.231L113.403,157.775z"/>
                            <path d="M160.338,164.464c0.262,0.027,0.522,0.04,0.78,0.04c3.795,0,7.052-2.872,7.451-6.729l3.458-33.468
                                c0.426-4.121-2.569-7.806-6.689-8.231c-4.121-0.422-7.806,2.57-8.232,6.689l-3.458,33.468
                                C153.223,160.354,156.218,164.039,160.338,164.464z"/>
                            <path d="M102.266,197.064c-12.801,0-23.215,10.414-23.215,23.215c0,12.804,10.414,23.221,23.215,23.221
                                c12.801,0,23.216-10.417,23.216-23.221C125.481,207.479,115.067,197.064,102.266,197.064z M102.266,228.5
                                c-4.53,0-8.215-3.688-8.215-8.221c0-4.53,3.685-8.215,8.215-8.215c4.53,0,8.216,3.685,8.216,8.215
                                C110.481,224.812,106.796,228.5,102.266,228.5z"/>
                            <path d="M179.707,197.064c-12.801,0-23.216,10.414-23.216,23.215c0,12.804,10.415,23.221,23.216,23.221
                                c12.802,0,23.218-10.417,23.218-23.221C202.925,207.479,192.509,197.064,179.707,197.064z M179.707,228.5
                                c-4.53,0-8.216-3.688-8.216-8.221c0-4.53,3.686-8.215,8.216-8.215c4.531,0,8.218,3.685,8.218,8.215
                                C187.925,224.812,184.238,228.5,179.707,228.5z"/>
                            <path d="M224.569,91.057c-1.42-1.837-3.611-2.913-5.933-2.913H69.141l-6.277-24.141c-0.86-3.305-3.844-5.612-7.259-5.612h-30.74
                                c-4.142,0-7.5,3.358-7.5,7.5s3.358,7.5,7.5,7.5h24.941l6.221,23.922c0.034,0.15,0.073,0.299,0.116,0.446l23.15,89.022
                                c0.86,3.305,3.844,5.612,7.259,5.612h108.874c3.415,0,6.399-2.307,7.259-5.612l23.211-89.25
                                C226.478,95.285,225.989,92.894,224.569,91.057z M189.626,177.395H92.35l-19.309-74.25h135.894L189.626,177.395z"/>
                            <path d="M135.674,74.826c1.464,1.464,3.384,2.197,5.303,2.197c1.92,0,3.839-0.732,5.303-2.197l24.28-24.28
                                c2.929-2.929,2.929-7.678,0-10.606c-2.929-2.928-7.678-2.928-10.606,0l-11.468,11.468l0.002-43.907
                                c0-4.142-3.357-7.501-7.499-7.501h-0.001c-4.142,0-7.5,3.358-7.5,7.499l-0.002,43.925l-11.468-11.468
                                c-2.929-2.929-7.678-2.929-10.606,0c-2.929,2.929-2.929,7.678,0,10.606L135.674,74.826z"/>

                        </g>
                    </svg>:  <span id="cartcount">0</span></button>
                <div id="notification"></div>
               

            </div>

        </nav>


    </header>
    <main>
       
        
        
        <section id="food_part">
            {% for food in foods %}
                {% if food.type == "pizza" %}
                    <div class="box1">
                        <div><img src="{{ food.image }}" alt="image"></div>
                        <div>
                            <h3>{{ food.name }}</h3>
                            <p>{{ food.description }}</p>
                            <div class="addtocart">
                                <span class="price">${{ food.price }}</span>
                                <button class="addtocart-btn" data-food-id="{{ food.id }}">add to cart</button>
                            </div>
                        </div>
                    </div>
                {% else %}
                    <div class="box2">
                        <h3>{{ food.name }}</h3>
                        <img src="{{ food.image }}" alt="image">
                        <p>{{ food.description }}</p>
                        <div class="addtocart">
                            <span class="price">${{ food.price }}</span>
                            <button class="addtocart-btn" data-food-id="{{ food.id }}">add to cart</button>
                        </div>
                    </div>
                    

                {% endif %}
            {% endfor %}

             {% comment %} cart info {% endcomment %}

            <div id="itemdetails" style="display: none;">
                <div class="popup-content">
                    <!-- Popup content -->
                    <button id="close">X</button>
                    <h2>Item Details</h2>
                    <table id="carttable">
                        <tr>
                            <th>Product Name</th>
                            <th>Price</th>
                            <th>Description</th>
                            <th>Action</th>
                        </tr>
                    </table>
                    <div class="btn-layer">
                        <button id="clearcart">Clear Cart</button>
                        <button id="payBtn">Pay</button>
                        {% comment %} <button id="makeorderbtn">Make Order</button> {% endcomment %}
                    </div>
                    <p id="totalprice">Total:$0</p>
                </div>

                {% comment %}  {% endcomment %}
                
                <div id="paymentDetails" style="display: none;">
                    <button id="closebtn">X</button>
                    <h2>Payment Details</h2>
                    <p id="orderid">Order ID: </p>
                    <p id="controlno">Control Number: </p>
                    <p id="totalPrice">Total Price:$</p>
                
                    <div id="paymentOptions">
                        <label>
                            <input type="radio" name="paymentOption" value="card" checked> Pay by Card
                        </label>
                        <label>
                            <input type="radio" name="paymentOption" value="mobile"> Pay by Mobile
                        </label>
                    </div>
                
                    <div id="cardDetails" style="display: block;">
                        <!-- Card details form fields -->
                        Card Number: <input type="text" name="cardNumber"><br>
                        Card Owner's Name: <input type="text" name="cardOwnerName"><br>
                        CVC: <input type="text" name="cvc"><br>
                    </div>
                
                    <div id="mobilePayment" style="display: none;">
                        <!-- Vendor list for mobile payment -->
                        <p>Choose a vendor:</p>
                        <label>
                            <input type="radio" name="mobileVendor" value="tigo"> Tigo
                        </label>
                        <label>
                            <input type="radio" name="mobileVendor" value="vodacom"> Vodacom
                        </label>
                        <label>
                            <input type="radio" name="mobileVendor" value="halotel"> Halotel
                        </label>
                        <label>
                            <input type="radio" name="mobileVendor" value="airtel"> Airtel
                        </label>
                    </div>
                
                    <button id="confirmPaymentBtn">Confirm Payment</button>
                </div>
            </div>
            
            
        </section>
        

    </main>

    <footer>
        <p>&copy; 2023 Mango</p>
    </footer>
</body>
<script  src="{% static 'js/foods.js' %}"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        // Fetch CSRF token from the cookie
        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    
        var csrftoken = getCookie('csrftoken');
    
        
        var orderid; // Define the variables outside the AJAX request
        var controlno;
    
        // Fetch user id
        $.ajax({
            url: '/api/putdelete',
            type: 'GET',
            success: function(response) {
                var user = response;
    
                // Get the userid from the user object
                var userid = user.id; // Replace 'userid' with the actual attribute name that contains the user ID
    
                // Function to generate orderid
                function generateOrderId(userid) {
                    // Get the current timestamp
                    const timestamp = Date.now();
                    // Generate a random four-digit number
                    const random = Math.floor(Math.random() * 10000);
                    // Get the current date and time of the order
                    const date = new Date();
                    // Format the date and time as YYMMDDHHmmss
                    const formattedDate = date
                        .toLocaleString("en-US", { hour12: false })
                        .replace(/[^\d]/g, "")
                        .slice(2);
                    // Concatenate the userid, random number, and formatted date to create the orderid
                    const orderid = `${userid}${random}${formattedDate}`;
                    return orderid;
                }
    
                // Call the generateOrderId() function and pass the userid
                orderid = generateOrderId(userid);
    
                // Function to generate controlno 
                function generateControlNumber() {
                    const min = 10000000;
                    const max = 99999999;
                    const controlno = Math.floor(Math.random() * (max - min + 1) + min);
                    return controlno;
                }
    
                controlno = generateControlNumber();
                
            },
            error: function(xhr, textStatus, errorThrown) {
                console.log(xhr.responseJSON);
                alert('Failed to fetch user information.');
            }
        });
    
        const popupcontent = document.getElementsByClassName("popup-content")[0];
        const payBtn = document.getElementById("payBtn");
        const paymentDetails = document.getElementById("paymentDetails");
    
        payBtn.addEventListener("click", () => {
            // Update the HTML elements with the generated values
            document.getElementById("orderid").textContent = `Order ID: ${orderid}`;
            document.getElementById("controlno").textContent = `Control Number: ${controlno}`;
            paymentDetails.style.display = "block";
            popupcontent.style.display = "none";
        });

    });
    
    
</script>
</html>

